# üìò pyDock3 Multi-Ligand Batch Pipeline

[![Shell Script](https://img.shields.io/badge/Script-Bash-4EAA25?logo=gnu-bash\&logoColor=white)]()
[![pyDock3](https://img.shields.io/badge/pyDock3-Docking%20Engine-1f77b4)]()
[![AlphaFold2](https://img.shields.io/badge/AlphaFold2-Models-blue)]()
[![Greasy Scheduler](https://img.shields.io/badge/Greasy-Job%20Scheduler-9c27b0)]()

Automated workflow for generating **pyDock3 configuration files** (`INI`) from AlphaFold2 prediction folders and launching large-scale binding-energy evaluations using **Greasy**.
The script scans AF2 directories, builds one or multiple receptor‚Äìligand configurations per model, and schedules all pyDock3 runs in parallel.

---

## üìå Features

* Automatic discovery of AF2 prediction folders (`fold*/`, `*colab*v*/`)
* Detection of all PDB models inside each prediction directory
* Multi-ligand, multi-configuration `INI` generation
* Fully automated pyDock3 command list creation
* Greasy-powered parallel energy calculations
* Environment-variable customization of receptors, ligands, paths, and workers

---

## üìÅ Workflow Summary

```
AF2 Models ‚Üí Chain Definitions ‚Üí pyDock3 INI Files ‚Üí Greasy Job List ‚Üí Binding-Energy Calculations
```

---

# üîß Input Variables

The script uses several environment variables, each with a default value.
Override them as needed before execution.

---

## **1. `CASE` ‚Äî Case Identifier**

**Purpose:**
Defines the base folder to search (`${CASE}/AF2/`).

**Default:**

```bash
4POU
```

**Override:**

```bash
export CASE="MyProject"
```

---

## **2. `PYDOCK` ‚Äî Path to pyDock3**

**Purpose:**
Specifies where the `pyDock3` executable resides.

**Default:**

```
/usr/local/software/pyDock3/
```

**Override:**

```bash
export PYDOCK="/opt/pydock3"
```

---

## **3. `GREASY` ‚Äî Path to Greasy Executable**

**Purpose:**
Defines where the `greasy` binary is located.

**Default:**

```
/path/to/software/greasy/
```

**Override:**

```bash
export GREASY="/opt/greasy"
```

---

## **4. `GREASY_NWORKERS` ‚Äî Number of Parallel Workers**

**Default:**

```bash
8
```

Set based on CPU/GPU availability:

```bash
export GREASY_NWORKERS=4
```

---

## **5. `CHAINS_REC_LIG_VALUES` ‚Äî Receptor/Ligand Chain Definitions**

**Purpose:**
Controls how chains inside each PDB model are assigned to **receptor** and **ligand** when generating `INI` files for pyDock3.

Each entry in this array must follow:

```
"RECEPTOR_CHAINS LIGAND_CHAINS"
```

### üìå Interpretation Rules

* Text **before** the space ‚Üí receptor chain(s)
* Text **after** the space ‚Üí ligand chain(s)
* Multiple chains are allowed via commas (`A,B`)
* **Each array entry produces one `INI` file per PDB model**

‚û°Ô∏è If you define **N entries**, the script will generate **N `INI` files per model**.

---

# üß¨ Chain Definition Examples

### **1Ô∏è‚É£ Simple Case**

```bash
export CHAINS_REC_LIG_VALUES=("A B" "A C")
```

Generates **two** `INI` files for every PDB model:

* Receptor = A, Ligand = B ‚Üí `*_LIG_B.ini`
* Receptor = A, Ligand = C ‚Üí `*_LIG_C.ini`

---

### **2Ô∏è‚É£ Multiple Receptor Chains**

```bash
export CHAINS_REC_LIG_VALUES=("A,B C")
```

Interpretation:

* Receptor = A,B
* Ligand = C

Generates **one** `INI` file per PDB:

```
*_LIG_C.ini
```

---

### üßæ Summary Table

| Definition             | Receptor | Ligand | Result                        |
| ---------------------- | -------- | ------ | ----------------------------- |
| `"A B"`                | A        | B      | 1 `INI`                      |
| `"A C"`                | A        | C      | 1 `INI`                      |
| `"A,B C"`              | A,B      | C      | 1 `INI`                      |
| Multiple array entries | ‚Äî        | ‚Äî      | Multiple `INI` files per PDB |

---

# üìÇ Output Structure

After execution, the script produces:

```
${CASE}/AF2/
‚îÇ
‚îú‚îÄ‚îÄ fold*/ or *colab*v*/            # AF2 prediction folders
‚îÇ   ‚îú‚îÄ‚îÄ model_1.pdb
‚îÇ   ‚îú‚îÄ‚îÄ model_2.pdb
‚îÇ   ‚îî‚îÄ‚îÄ ... + generated *.ini files
‚îÇ
‚îî‚îÄ‚îÄ Greasy_BindE_mul_ligs.txt       # Command list for Greasy
```

---

# ‚öôÔ∏è Parallel Execution with Greasy

All pyDock3 commands are stored in:

```
Greasy_BindE_mul_ligs.txt
```

Run them in parallel:

```bash
$GREASY/greasy Greasy_BindE_mul_ligs.txt
```

---

# üì¶ Requirements

* **pyDock3**
* **AlphaFold2** or **ColabFold** PDB outputs
* **Greasy** job scheduler
* GNU **bash**
* Linux environment

---

# ‚ñ∂Ô∏è Usage Example

```bash
export CASE="KinaseProject"
export PYDOCK="/opt/pydock3"
export GREASY="/opt/greasy"
export GREASY_NWORKERS=6
export CHAINS_REC_LIG_VALUES=("A B" "A C")

bash run_pydock_batch.sh
```

---

# ‚ùó Troubleshooting

| Issue                   | Likely Cause                            |
| ----------------------- | --------------------------------------- |
| No `INI` files created | Wrong chain definitions or empty folder |
| Greasy does not start   | Incorrect `GREASY` path                 |
| pyDock3 errors          | Missing residue names or invalid PDB    |
| No PDB files found      | Incorrect AF2 folder structure          |
